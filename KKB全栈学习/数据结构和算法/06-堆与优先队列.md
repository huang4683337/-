堆又叫优先队列

## 堆的基础知识

![1617884432218](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617884432218.png)



**完全二叉树和堆的关系很亲密**



### 完全二叉树在内存中的存储

+ 完全二叉树 是思维逻辑结构（二维）
+ 实际上在内存中存储结构为数组（一维）

![1617884544749](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617884544749.png)





### 堆

![1617884848437](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617884848437.png)

+ 大顶堆：任意三元节组中，父节点比子节点大。（最大值在根节点）
+ 小顶堆：任意三元节组中，父节点比子节点小。（最小值在根节点）



**第二大值**：根的左子节点、或者根的右子节点（第二层）

**第三大值**：大小的比较只能是父子，不能是兄弟（第二层或者第三层）

第一大值在：第一层

第n大值：在 2 到 n 曾





![1617885414948](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617885414948.png)

+ 先向尾部追加一个元素
+ **向上调整（SIFT-UP）**这个元素和父节点去比，大于父节点，两两交换，直至小于父节点



![1617886002836](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617886002836.png)



+ 弹出堆顶的最大值（数组中的组大值）
+ **因为堆是一个完全二叉树**（需要占用一个连续的存储空间），所以弹出一个之后，数组的有效值长度要减去1，将最后一个元素（有效值，但是不在有效存储空间上）放入数组最前面
+ 从根节点开始，任意三元组之间**向下调整（SIFT-DOWN）**将最大的放在父节点位置



![1617886471132](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617886471132.png)



**从小到大排序**

+ 建立一个大顶堆

+ 从首位开始弹出 

  + 对应堆的数组首位为空
  + 对应堆的数组长度减去1，原来数组最后一位不是有效位置
  + 位于原来数组的最后一位是有效值，所以需要将最后一位的有效值放入第一位
  + 对处理后的堆进行排序，保证任意三元组之间父节点值大于子节点值

+ 利用以上特性将弹出的值, 放入数组最后一位(也就是无效位置)

  将无效位置的有效值放入数组第一个位置, 以此类推

+  最大值和数组最后一个互换，次大值和数组倒数第二个互换。最终结果就是排序结果





![1617887228650](C:\Users\Amd\AppData\Roaming\Typora\typora-user-images\1617887228650.png)

**优先队列通常情况下是用堆来实现的**

因为堆是从数组末尾进入元素, 从数组的头部出元素, 在数组层面和队列相似

为甚么叫优先队列: 每次出堆的都是优先级最高的(最大后者最小)



**堆是优先队列的实现方式**





### 堆的代码实现

+ 堆（完全二叉树）找到父节点：
  + 左子节点的索引 = 2父节点索引+1
  + 右子节点的索引 = 2父节点索引+2
  + （子节点索引 - 1） /  2  向下取整就是父节点索引
+ 堆（完全二叉树）确认是否还有子节点
  +  2父节点索引+1 < = 数组长度 - 1





## 堆适合处理什么问题

**堆适合维护**：集和最值





## 经典面试题：堆的基础应用

### 1、[剑指 Offer 40. 最小的k个数](https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/)

```js
1 - 有个备选集和，存储的值是最终答案
2 - 新的元素和备选集和的最大值去比较，小于最大值时，替换备选集合中的最大值

3 - 因为要和集和的最大值比较，所以需要一个大顶堆
```



### 2、[1046. 最后一块石头的重量](https://leetcode-cn.com/problems/last-stone-weight/)

```js
// 集和中求最值
1 - 取出最大值、次大值
2 - 处理结果不相等，处理结果压入堆中
3 - 以此类推，直到剩下最后一个
// 因为最大值，所以大顶堆
```



### 3、[703. 数据流中的第 K 大元素](https://leetcode-cn.com/problems/kth-largest-element-in-a-stream/)

```js
1 - 有个备选集和，存储的值是最终答案,前k大元素
2 - 新元素比备选集和中的最小值大，替换备选集和最小值
// 因为要和备选集和最小值比较，所以是个小顶堆
```



### 4、[215. 数组中的第K个最大元素](https://leetcode-cn.com/problems/kth-largest-element-in-an-array/)

```js
// 保留几个大的，谁小谁出去
// 需要小顶堆
```



### 5、[373. 查找和最小的K对数字](https://leetcode-cn.com/problems/find-k-pairs-with-smallest-sums/)

```js
// 保留几个小的，谁大谁出去
// 需要大顶堆
```





## 经典面试题：进阶

### 1、[692. 前K个高频单词](https://leetcode-cn.com/problems/top-k-frequent-words/)



### 2、[295. 数据流的中位数](https://leetcode-cn.com/problems/find-median-from-data-stream/)

